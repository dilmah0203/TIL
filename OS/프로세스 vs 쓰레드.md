## 프로세스 vs 쓰레드

![img](https://github.com/dilmah0203/TIL/blob/main/Image/Process.png)

- **프로세스**
  - **자원 할당의 단위**
  - 프로세서(CPU)가 실행 중인 프로그램이며 각 프로세스는 독립적이다.
  - 프로세스는 1개 이상의 쓰레드를 가지고 있다.

- **쓰레드**
  - 프로세스 내에서 할당받은 자원을 이용해 동작하는 **작업 단위**
  - 쓰레드는 프로세스 내에서 각각 Stack만 따로 할당받고 Code, Data, Heap 영역은 공유한다.
  (Stack을 분리한 이유는 Stack에는 메소드의 호출 정보가 저장되는데, Stack을 공유하면 LIFO 구조에 의해 실행 순서가 복잡해지기 때문에 실행 흐름을 원활하게 만들기 위함이다.)

**프로그램 → 프로세스 → 쓰레드**

프로그램이란, 어떤 작업을 위한 정적인 상태의 파일을 말한다. 프로그램을 실행함으로써 해당 파일은 메모리를 할당받게되고, 이 상태를 동적인 상태라고 하며 프로세스가 된다.

쓰레드는 프로세스의 자원을 이용하여 작업을 수행한다.

## 문맥 교환(Context Switching)이란?

Context Switching이란 인터럽트를 발생시켜 CPU에서 실행중인 프로세스를 중단하고, 다른 프로세스를 처리하는 것을 말한다. Context Switching은 현재 실행중인 프로세스의 상태(Context)를 먼저 저장하고, 다음 프로세스를 동작시켜 작업을 처리한 후에 이전에 저장된 프로세스의 상태를 다시 복구한다. 여기서 인터럽트란 CPU가 프로세스를 실행하고 있을 때, 입출력 하드웨어 등의 장치나 예외상황이 발생하여 처리가 필요함을 CPU에게 알리는 것을 말한다.

## 멀티 프로세스 vs 멀티 쓰레드

- 멀티 프로세스
  - 하나의 프로그램을 여러 개의 프로세스로 구성하여 각 프로세스가 하나의 작업을 처리하는 것
 
- 멀티 쓰레드 
  - 하나의 프로세스 내에서 여러개의 쓰레드로 구성하여 각 쓰레드가 하나의 작업을 처리하는 것
  
 이 둘의 공통점은 여러 작업을 동시에 혹은 병렬적으로 처리함으로써 작업 속도를 높일 수 있다는 장점이 있다.
  
### 멀티 프로세스의 특징
  
CPU는 한 번에 한개의 프로세스만 처리가 가능하다. 여러 작업이 동시에 실행되는 것처럼 보이지만 CPU는 계속해서 프로세스들을 바꿔주는 일을 내부적으로 진행하고 있다. 하나의 프로세스에 대한 정보들을 저장해놓고, 새로운 프로세스에 대한 정보를 가져오고 메모리를 할당해주는 과정을 **문맥 교환(Context Switching)이라고 하는데, 이 문맥교환 동안의 오버헤드가 발생한다.**

### 멀티 쓰레드의 특징
  
쓰레드는 한 프로세스 내부의 실행단위이기 때문에 프로세스 내부에서 Code, Data, Heap 영역을 서로 다른 쓰레드끼리 공유할 수 있다. CPU에서는 쓰레드 간 문맥교환을 위해 PCB 내부에 있는 Register Block을 통해 쓰레드를 구분하는데, 멀티 쓰레드로 분할 작업을 수행하게 된다면 Code, Data, Heap 영역을 메모리에 올리고 내리는 무거운 작업을 할 필요가 없어진다. 쓰레드를 구분 할 Register Block만 교체하면 되기 때문이다.
  
> PCB(Process Control Block)란? 
> 
> 프로세스에 대한 정보를 담고 있는 자료구조로 PCB에 담긴 프로세스 정보를 이용하여 프로세스를 관리/제어한다. 프로세스가 생성될 때마다 고유의 PCB가 생성되고 프로세스가 완료되면 제거된다.

### 무조건 멀티 쓰레드를 사용하는 것이 좋을까?

멀티 프로세스는 프로세스가 죽어도 다른 프로세스들은 계속 실행될 수 있는 반면 멀티 쓰레드는 서로 독립적이지 못하므로 오류가 생길 시에 같은 메모리 영역(Code, Data, Heap)을 공유하고 있는 다른 쓰레드에게도 영향을 미칠 수 있다. 또한 여러 쓰레드가 하나의 자원에 동시에 접근할 경우 동기화 문제가 발생할 수 있다.


