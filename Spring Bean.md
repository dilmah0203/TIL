## Spring Bean

Spring Bean이란 스프링 IoC 컨테이너가 관리하는 객체이다.

> Spring Bean이 왜 필요할까?

1. 빈과 의존성 주입

```java
Service service = new Service(new JdbcDao());
```

객체를 빈으로 등록하지 않고 의존성 주입을 도입한다면, new 키워드를 사용하여 객체를 생성해야 한다. 위 코드는 Service를 초기화하는데 Service의 생성자로 Dao 구현체를 생성하여 넣어주었다. 만약 Dao 구현체가 바뀔경우 서비스를 생성하는 곳에서도 변경이 일어난다. 왜냐하면 어떤 Dao의 구현체를 선택할 것인지에 대한 책임도 가지기 때문이다.

또한 의존성 주입 시에 여러 개의 의존성이 필요하다면 해당 의존성 주입 순서를 알아야 한다. 애플리케이션의 규모가 커질 경우 의존 관계를 모두 파악해야하는 번거로움이 생긴다.

스프링은 의존성 주입이 필요한 객체를 빈으로 등록하여 의존성 주입을 관리해주기 때문에, 의존성을 사용하는 부분에만 집중할 수 있게 된다.

2. 빈과 싱글톤

객체를 싱글톤으로 만들어 사용한다는 것은 싱글톤 패턴을 적용한다는 말과 같다. 하지만 싱글톤 패턴에는 단점이 있다. 첫 번째로, 다형성을 이용하지 못한다. 싱글톤 패턴을 사용하면 생성자의 접근제어자를 private로 설정해야 하는데 이렇게 구현하면 해당 객체는 상속이 불가능하게된다. 두 번째는 단위 테스트가 어렵다. 객체를 싱글톤 패턴으로 구현할 경우 해당 객체는 공유 객체가 되므로 테스트를 실행할 때 테스트 순서에 따라 결과가 달라진다.

3. Spring IoC 컨테이너는 빈을 어떻게 관리할까?

**IoC 컨테이너가 빈의 라이프사이클을 관리하는 과정**

Spring IoC 컨테이너가 생성이 되면 빈 스코프가 싱글톤인 객체를 생성한다. 이 때 빈으로 등록하기 위해 어노테이션 기반 혹은 java 설정 클래스 기반, xml 기반의 다양한 Configuration을 이용하여 통일된 Bean Definition을 생성한다. 그리고 빈으로 등록할 POJO와 Bean Definition 정보를 이용하여 빈을 생성한다. IoC 컨테이너는 싱글톤 레지스트리라는 기능을 통해 key와 value 형태로 데이터를 저장하는데,
Spring IoC 컨테이너는 빈 스코프가 싱글톤인 객체에 빈의 이름을 key, 객체를 value로 저장하여 의존성이 주입 되어야 하는 객체가 빈으로 등록되어 있을 때 스프링은 빈의 이름을 이용하여 항상 동일한 Single Object를 반환한다.

빈 객체가 생성이 되면 IoC 컨테이너는 의존 설정을 하고 의존성 자동 주입이 일어나게 된다. 그리고 객체를 초기화하는 과정이 진행된다. 초기화 과정이 끝나면 빈을 사용할 수 있고, 스프링 컨테이너가 종료될 때 빈 스코프가 싱글톤인 객체들도 함께 소멸된다.

4. 빈 설정시 주의점

예를 들어, 싱글톤 스코프의 빈이 value라는 상태를 가질 때 Thread 1은 value의 값을 증가시킨다. Thread 2는 value라는 값을 가져와 사용 한다고 하면, 매번 다른 값을 사용할 수 있게 된다. 즉 해당 빈의 상태를 항상 예측할 수 없다. 따라서 빈 스코프를 싱글톤으로 설정할 경우 **상태를 가지면 안된다.**

빈 스코프 타입을 프로토타입으로 설정한다면, IoC 컨테이너와 함께 생성되고 소멸되는 것이 아닌 요청이 올 때마다 객체가 생성된다. 모든 쓰레드에서 공유하는 것이 아니므로 해당 객체는 상태를 가질 수 있다.

정리하자면, 스프링 빈은 스프링 IoC 컨테이너가 특정 객체의 라이프사이클을 관리한다는 것을 명시한다. 스프링 IoC 컨테이너는 의존성을 자동 주입해 개발자들이 해당 의존성을 **사용**하는 로직에만 집중할 수 있게 한다. 또한 의존성이 주입 될 객체가 싱글 오브젝트임을 보장한다.

<br>

참고

https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-introduction(https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-introduction)
