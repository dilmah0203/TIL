## 쿠키와 세션

### 쿠키와 세션을 사용하는 이유

HTTP 프로토콜은 비연결지향(Connectionless) & 무상태(Stateless)라는 특징을 가진다. 통신 연결을 유지하지 않기 때문에 리소스 낭비가 줄어들지만 통신할 때마다 인증해야하는 문제가 있다. 이러한 단점을 보완하기 위해 쿠키와 세션을 사용한다.

## 쿠키

- 쿠키는 클라이언트 로컬(브라우저)에 저장되는 키와 값이 들어있는 작은 데이터 파일로 클라이언트의 상태 정보를 로컬에 저장했다가 요청할 때 참조된다.
- 쿠키 이름과 값, 유효기간이 등이 들어있다.
- 쿠키는 서버측에서 만료 날짜와 시간을 지정하여 정해진 시간동안 상태정보를 유지할 수 있다.
- 쿠키 프로세스
  - 브라우저에서 웹 페이지 접속
  - 서버는 쿠키를 생성하여 전달(Response Header의 set-Cookie)
  - 클라이언트는 쿠키를 클라이언트 로컬(하드)에 저장
  - 클라이언트가 재요청 시, 웹 페이지 요청과 함께 쿠키값도 전송
  - 서버는 쿠키로 사용자를 식별하고 요청을 처리
- 쿠키 사용용도 : 자동로그인, 장바구니 
 
**쿠키 생성**

```jsp
Cookie c = new Cookie("쿠키이름", "쿠키의 값");
```
  
```jsp
Cookie c = Cookies.createCookie("쿠키이름", "쿠키의 값"); //Cookies 클래스를 이용하여 생성
```

**쿠키 유효기간 설정**

```jsp
c.setMaxAge(); //()안은 milli second 단위
```

**쿠키 값 읽어오기**

getCookie() 메소드는 배열을 리턴하므로 반복문을 이용하여 처리하는 것이 일반적이다. Cookies 클래스의 getCookie(), getValue(), exists()등의 메소드를 사용할 수 있다.

```jsp
 Cookie[] c = request.getCookies();
```
 
**쿠키 값 변경 및 삭제**

쿠키 값을 변경하려면 같은 이름의 쿠키를 새로 생성하면 된다. 쿠키를 삭제하려면 Cookie클래스의 setMaxAge()메소드를 호출할 때 매개 변수(유효시간) 값을 0을 주면 된다.

## 세션

- 세션은 웹 브라우저가 아닌 서버에 클라이언트의 상태 정보를 저장한다. 클라이언트가 요청을 보내면 서버가 클라이언트에게 유일한 ID(Session ID)를 부여한다.
- 세션 프로세스
  - 클라이언트가 서버에 접속 시 Session ID를 발급
  - 서버에서는 Session ID를 쿠키를 통해 저장(JESSIONID)하고 클라이언트에 전달(Response Header의 set-Cookie)
  - 클라이언트는 쿠키를 클라이언트 로컬에 저장
  - 클라이언트는 다시 접속할 때 쿠키를 이용하여 Session ID값을 서버에 전달한다.
- 세션 사용용도 : 로그인 정보 유지
  
**세션 정보 저장**

세션에 값을 저장할 때는 속성을 사용한다.

```jsp
session.setAttribute("속성", "데이터 값");
```
  
**세션 정보 가져오기**

```jsp
session.getAttribute(); //getAttribute 메소드는 기본 반환값이 객체이므로 원하는 데이터 타입으로 캐스팅 해주어야 한다.
 
String s = (String)session.getAttribute("속성이름");
```
  
**세션 정보 제거하기**

```jsp
session.removeAttribute("데이터항목이름"); //특정세션 정보 제거
session.invalidate(); //전체 정보 제거
```

**세션 유효시간 설정**
- web.xml 파일에 <session-config>태그를 사용하여 세션 유효시간(분 단위) 지정
- session 기본 객체의 setMaxInactiveInterval( )메소드 사용(초 단위)
  
## 쿠키와 세션의 차이
  
- 저장위치
  - 쿠키는 브라우저에 메모리 또는 파일로 저장하고, 세션은 서버 메모리에 저장된다.
- 보안
  - 쿠키는 로컬에 저장되어 탈취, 변조될 위험이 있고 request/response에서 스나이핑 당할 위험이 있어 취약하다. 
  - 자바스크립트로 쿠키를 가로채려고 할 때 쿠키 생성 코드에 HttpOnly를 쿠키 생성 코드에 추가함으로써 XSS 공격이 차단된다. 또한 HTTPS로 전송되어야 할 정보가 HTTP를 통해 유출되는 경우 secure를 사용할 수 있다.
  - 반대로 세션은 클라이언트 정보 자체가 서버에 저장되어 있어서 비교적 안전하다.
- 라이프사이클
  - 쿠키는 파일로 저장되기 때문에 브라우저를 종료하더라도 저장되어 있을 수 있는 반면 세션은 서버에서 만료시간을 정하여 지울 수 있고 브라우저 종료 시 세션 만료시간에 관계없이 삭제된다.
- 속도
  - 쿠키에 정보가 있기 때문에 서버 요청시 속도가 빠르고 세션은 정보가 서버에 있기 때문에 느리다.

**왜 둘 다 사용할까?**
세션은 쿠키에 비해 보안이 높은 편이나 서버의 자원에 한계가 있고 속도저하가 올 수 있기 때문에 쿠키와 세션을 적절히 사용하여 서버 자원의 낭비를 방지하고 웹사이트의 속도를 높일 수 있다.
