## JWT란?

**JWT**는 **Json Web Token**의 약자로 클라이언트와 서버 사이에서 통신할 때 권한을 위해 사용하는 토큰이다. 웹 상에서 정보를 Json 형태로 주고 받기 위해 표준규약에 따라 생성한 **암호화된 토큰**으로 복잡하고 읽을 수 없는 string 형태로 저장되어있다. 인증이 필요할 때마다 서버에 토큰과 함께 요청을 보내게 된다. 서버는 저장된 데이터가 아닌 토큰 해독을 통해 사용자를 식별할 수 있고 이를 바탕으로 인증이 진행된다.

### JWT의 구성요소

JWT는 헤더(Header), 페이로드(Payload), 서명(Signature)으로 구성되어 있다. Json(Key/Value) 형태로 정보를 넣을 수 있다. 

![img](https://github.com/dilmah0203/TIL/blob/main/Image/JWT%20Token.PNG)

1. **헤더(Header)**

토큰의 헤더는 alg와 typ 두 가지 정보로 구성된다.

- alg는 어떤 알고리즘으로 암호화 할 것인지 ex)HS256 or RSA
- typ는 토큰의 타입에 대한 정보가 들어있다. ex)JWT


2. **페이로드(Payload)**

토큰에서 사용할 정보인 클레임(Claim)이 담겨 있다. 

- 등록된 클레임(Registered Claim)은 토큰 정보를 표현하기 위해 미리 정해진 종류의 데이터들로, Json(Key/Value) 형태로 다수의 정보를 넣을 수 있다.
    - iss: 토큰 발급자
    - exp: 토큰 만료 시간
    - sub: 토큰 제목
    - aud: 토큰 대상자

- 공개 클레임(Public Claim) 

공개 클레임은 사용자 정의 클레임으로, 공개용 정보를 위해 사용된다. 충돌 방지를 위해 URI 포맷을 이용한다.

- 비공개 클레임(Private Claim) 

비공개 클레임은 사용자 정의 클레임으로, 서버와 클라이언트 사이에 임의로 지정한 정보를 저장한다. 

3. **서명(Signature)**

서명은 토큰을 인코딩하거나 유효성 검증을 할 때 사용하는 고유한 암호화 코드이다. 서명에서 사용하는 알고리즘은 헤더에서 정의한 alg를 활용한다. 위에서 만든 헤더와 페이로드의 값을 각각 BASE64Url로 인코딩하고, 인코딩한 값을 비밀 키를 이용해 헤더에서 정의한 알고리즘으로 해싱하고, 다시 BASE64Url로 인코딩하여 생성한다.

생성된 토큰은 HTTP 통신을 할 때 Authorization이라는 key의 value로 사용된다. 일반적으로 value에는 Bearer이 앞에 붙여진다.

```http
{ 
    "Authorization": "Bearer {생성된 토큰 값}"
 }
```

### JWT의 동작원리

JWT에서는 기본적으로 공개키 암호화 방식을 사용하는데, 비대칭 암호 방식을 이용해 공개키와 비밀키를 생성하여 나누어 가지고 통신한다. 서명은 비밀키가 있는 쪽에서만 할 수 있고 공개키를 가진 누구나 이 데이터의 서명을 검증할 수 있다.

공개키를 가진 누구나 데이터를 암호화해서 데이터를 보낼 수 있지만, 비밀키를 가진 곳에서만 데이터를 복호화하여 내용을 확인할 수 있다.

![img2](https://github.com/dilmah0203/TIL/blob/main/Image/JWT%20Token2.png)

1. 클라이언트가 id와 password를 입력하고 서버로 로그인 요청을 보낸다.
2. 서버는 비밀키를 통해 서명을하고 공개키로 암호화시킨 JWT 토큰을 발급한다.
3. JWT 토큰을 클라이언트에게 보낸다. (로그인 완료 상태)
4. 클라이언트에서 서버로 서비스 요청 시 Authorization Header에 JWT Token을 같이 보낸다.
5. 서버에서 클라이언트가 보낸 JWT Token의 서명을 비밀키로 복호화하여 유효한 토큰인지 확인한다.
6. 서버가 요청에 대한 응답을 클라이언트에게 전달한다.

사용자 인증에 필요한 별도의 저장소가 필요없다는 장점이 있지만, 토큰은 상태를 저장하지 않으므로 임의로 삭제하는 것이 불가능하며 토큰 자체에 정보를 담고 있어 정보 노출 가능성이 있다.

<br>

참고

https://jwt.io/introduction
