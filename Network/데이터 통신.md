## 데이터 통신

네트워크란? 컴퓨터끼리 데이터를 주고받는 시스템을 말한다.

**네트워크 구성 요소**

- 단말 장치 : 다른 단말 장치에게 데이터를 송/수신한다. 스마트폰, 노트북 등이 있다.
- 전송 매체 : 단말 장치들을 연결하여 데이터 전달하며 흔히 랜선이라고 부른다.
- 네트워크 장비 : 데이터가 최종 도착지까지 전달될 수 있도록 경로를 판단한다. 네트워크 장비로는 허브, 스위치, 라우터 등이 있다.

## 1. 허브

허브는 하나의 네트워크에 여러 개의 단말 장치가 연결될 수 있도록 포트 수를 늘려 분배하는 역할을 한다. 데이터의 수신을 구분해서 도착지에 전달하는 기능은 없기 때문에 단순 분배만을 수행한다.

![img](https://github.com/dilmah0203/TIL/blob/main/Image/Hub.png)

- 허브의 데이터 전달 과정
  - 단말 장치 A는 출발지 MAC 주소와 도착지 MAC 주소를 적은 요청 메세지를 허브에게 전송
  - 허브는 출발지로 적힌 단말 장치 외의 모든 단말 장치에게 받았던 메세지를 전송
  - 메세지를 받은 단말 장치 쪽에서 도착지 정보를 확인하고 나의 MAC 주소와 일치하지 않으면 무시하고 일치하면 수신
  
원하는 도착지의 단말 장치에만 메세지를 보내는 것이 아닌 **모든 단말 장치에게 전송**하고 메세지를 받은 단말 장치 쪽에서 나에게 온 메세지가 맞는지 판단하는 과정이 필요하다. 허브는 네트워크를 분배하는 역만을 수행할 뿐 데이터의 수신을 구분해서 도착지에 전달하는 기능은 없다.

## 2. 스위치

스위치는 허브의 단점을 해결한 것으로 도착지 한 곳에만 메세지를 전달한다. 도착지 위치 즉, 포트를 알기 위해 스위치의 각 단말 장치의 위치를 적어둔 MAC 주소 테이블을 사용한다. MAC 주소 테이블 MAC 주소를 기준으로 단말 장치가 스위치의 어느 포트에 연결되는지를 나타낸다.

![img2](https://github.com/dilmah0203/TIL/blob/main/Image/Switch.png)

- 스위치의 데이터 전달 과정
  - 단말 장치 A는 전송하고 싶은 데이터와 출발지 MAC 주소 및 도착지 MAC 주소를 적어 메세지를 생성
  - 생성한 메세지를 스위치에게 전달하면 스위치는 어느 포트에 메세지를 전달해야 하는지 확인 
  - 도착지에 적힌 MAC 주소(c)와 일치하는 포트 정보(4)를 찾고 해당 포트에 메세지를 전송

스위치는 허브와 달리 도착지 한 곳에만 메세지를 전달하므로 충돌이 일어날 가능성이 적다. 스위치는 MAC 주소 테이블을 사용하여 **도착지 단말 장치 자체에** 데이터를 전송할 수 있다.

**ARP**(Address Resolution Protocol)는 주소 결정 프로토콜로, 목적지 IP 주소에 대응되는 MAC 주소를 결정한다. 도착지의 MAC 주소 정보를 모르는 상황에서 IP 주소를 이용하여 MAC 주소를 찾을 수 있다.

![img3](https://github.com/dilmah0203/TIL/blob/main/Image/ARP1.png)
![img3](https://github.com/dilmah0203/TIL/blob/main/Image/ARP2.png)

- MAC 주소는 어떻게 알아 낼까?
  - 단말 장치 A는 스위치에게 ARP 요청 메세지를 보내면, 그럼 스위치는 2번 포트에서 단말 장치 A에게 메세지를 받았으므로 포트 2번에 단말 장치 A가 연결 되어 있는 것을 알게된다.
  - MAC 주소 테이블에 단말 장치 A의 MAC 주소(a)와 포트 정보(2)를 저장해둔다.
  - ARP 요청 메세지를 받은 스위치는 단말 장치 A를 제외한 모든 단말 장치에게 위에서 받은 메세지를 복사하여 전달한다. 이처럼 데이터를 수신한 단말 장치 이외에 모든 단말 장치에게 단순 복사하여 전달하는 과정을 **플러딩**이라고 한다.
  - ARP 요청 메세지를 받은 다른 단말 장치들은 자신의 IP 정보와 비교하여 IP 정보가 다르면 무시하고 일치하면 ARP 응답 메세지를 스위치에게 전송
  - ARP 응답 메세지는 ARP 요청 메세지에 있었던 출발지 MAC 주소와 자신의 MAC 주소를 사용하여 생성
  - 스위치는 ARP 응답 메세지를 확인하고 포트 4번에 단말 장치 C가 연결 되어 있다는 것을 확인하고 MAC 주소 테이블에 해당 정보 추가
  - ARP 과정을 통해 단말 장치 A는 단말 장치 C의 MAC 주소를 알게되고 데이터 전송 시 활용

허브와 스위치는 하나의 네트워크로 연결 한다는 점은 같지만, 허브는 받은 메세지를 연결된 모든 단말 장치에 전송하는 반면 스위치는 MAC 주소 테이블을 사용하여 도착지 단말 장치에만 메세지를 전송한다.

## 3. 라우터

서로 다른 네트워크 상에서는 메세지를 어떻게 전송할까?

라우터가 관리하는 테이블을 라우팅 테이블이라고 부르며 네트워크 주소와 서브넷 마스크, 출력 인터페이스(포트정보)를 정보로 가진다.

![img4](https://github.com/dilmah0203/TIL/blob/main/Image/Router.png)

- 라우터가 통신을 중계하는 과정
  - 네트워크 A에 속해있는 단말 장치가 라우터로 메세지를 전달
  - 라우터는 메세지에 담긴 도착지 IP를 라우팅 테이블에 있는 모든 서브넷 마스크와 비교한다.
  - 서브넷마스크와 도착지 IP를 비교하여 메세지를 전달해야 하는 네트워크의 주소가 10.3.0.0임을 알 수 있다.
  - 라우터는 네트워크 C가 연결되어 있는 R3 포트로 메세지를 전송한다.

## 4. 정리

![img5](https://github.com/dilmah0203/TIL/blob/main/Image/Network.png)

- 네트워크 A에 있는 단말장치 A가 네트워크 Z에 있는 단말 장치 Z에게 데이터를 전송하는 과
  - 단말장치 A는 출발지와 도착지 정보(IP, MAC주소)가 담긴 메세지를 생성하고 스위치 A에게 전송
  - 스위치 A는 MAC 주소 테이블을 활용해 네트워크 A에 단말 장치 Z가 있는지 확인
  - 단말 장치 Z가 없다는 것을 확인하고 다른 네트워크로 메세지를 보내기 위해 라우터 A에게 메세지 전송
  - 라우터 A는 라우팅 테이블에 있는 정보와 받은 메세지 정보를 비교하여 메세지의 도착지가 속해있는 네트워크 Z를 찾음
  - 네트워크 Z가 연결되어 있는 라우터 Z로 데이터 전송 후 동일한 네트워크의 스위치 Z로 메세지를 보내고
  - 스위치 Z는 MAC 주소 테이블을 이용하여 단말 장치 Z를 찾아 전달 

